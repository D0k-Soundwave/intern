# Model Context Protocol (MCP) Requirements and Compliance Guide
*Last Updated: August 2025*

## Table of Contents
1. [Overview](#overview)
2. [Core Requirements](#core-requirements)
3. [Technical Specifications](#technical-specifications)
4. [Security Requirements](#security-requirements)
5. [Implementation Best Practices](#implementation-best-practices)
6. [SDK Requirements](#sdk-requirements)
7. [Manifest Configuration](#manifest-configuration)
8. [Testing and Validation](#testing-and-validation)

---

## Overview

The Model Context Protocol (MCP) is an open standard framework introduced by Anthropic in November 2024 to standardize AI system integration with external tools, systems, and data sources. As of 2025, it has been adopted by major platforms including OpenAI, Google DeepMind, and Microsoft.

### Current Specification Versions
- **2024-11-05**: Initial release
- **2025-03-26**: OAuth 2.1 authorization support
- **2025-06-18**: Resource Indicators and enhanced security

---

## Core Requirements

### 1. Architecture Requirements

#### Client-Server Model
- **MCP Clients**: AI applications (Claude Desktop, ChatGPT, Copilot, etc.)
- **MCP Servers**: Provide standardized access to data sources
- **Communication**: Well-defined protocol supporting local and remote execution

#### Three Essential Primitives
1. **Tools**: Executable functions for retrieving information or performing actions
2. **Resources**: Data included in model context (files, database records, API responses)
3. **Prompts**: Templates guiding model interactions with tools/resources

### 2. Protocol Compliance

#### RFC Compliance
All implementations MUST follow RFC 2119 keywords:
- **MUST / MUST NOT**: Absolute requirements
- **SHOULD / SHOULD NOT**: Strong recommendations
- **MAY / OPTIONAL**: Truly optional features

#### Capability Negotiation
- Servers MUST declare supported capabilities during initialization
- Clients MUST respect server capability declarations
- Both MUST implement capability-based feature negotiation

---

## Technical Specifications

### Transport Requirements

#### Supported Transport Types (2025)
1. **stdio** (Standard Input/Output)
   - Local process communication
   - Best for desktop applications
   
2. **HTTP + Server-Sent Events (SSE)**
   - Legacy transport (2024-11-05 spec)
   - Requires persistent connections
   - Not suitable for serverless environments
   
3. **Streamable HTTP** (Recommended)
   - New transport (2025-03-26 spec)
   - Supports serverless deployment
   - Better scalability and cost efficiency
   
4. **WebSockets**
   - Real-time bidirectional communication
   - Suitable for interactive applications

### Message Format
```json
{
  "jsonrpc": "2.0",
  "method": "tools/call",
  "params": {
    "name": "tool_name",
    "arguments": {}
  },
  "id": "unique_request_id"
}
```

### Session Management
- MUST maintain conversation state across requests
- SHOULD implement session timeout mechanisms
- MUST handle session cleanup properly

---

## Security Requirements

### 1. Authorization (2025 Updates)

#### OAuth 2.1 Implementation
- **MUST** implement OAuth 2.1 for authentication
- **MUST** support both confidential and public clients
- **SHOULD** support Dynamic Client Registration (RFC7591)

#### Resource Indicators (RFC 8707)
- Clients **MUST** implement Resource Indicators
- Tokens MUST be scoped to specific MCP servers
- Prevents token hijacking by malicious servers

### 2. Permission Model

#### Human-in-the-Loop
- **MUST** obtain explicit user consent before:
  - Invoking any tool
  - Accessing resources
  - Executing code
- **MUST** display clear permission prompts
- **SHOULD** implement granular permission controls

#### Principle of Least Privilege
- Request ONLY minimum necessary permissions
- Scope access to specific resources
- Implement time-based permission expiry

### 3. Security Testing

#### Required Security Measures
- **Static Application Security Testing (SAST)**
- **Software Composition Analysis (SCA)**
- **Dependency vulnerability scanning**
- **Command injection prevention**
- **Input sanitization**

#### Security Vulnerabilities to Address
- Prompt injection attacks
- Tool permission escalation
- Lookalike tool replacement
- Token leakage
- Command injection

---

## Implementation Best Practices

### 1. Server Development

#### TypeScript Implementation
```typescript
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio";

const server = new McpServer({
  name: "server-name",
  version: "1.0.0"
});

// Define tools
server.tool(
  "tool_name",
  {
    // Input schema using Zod
    param1: z.string(),
    param2: z.number()
  },
  async (args) => {
    // Implementation
    return {
      content: [{
        type: "text",
        text: "Result"
      }]
    };
  }
);

// Start server
const transport = new StdioServerTransport();
await server.connect(transport);
```

#### Python Implementation (FastMCP)
```python
from mcp.server.fastmcp import FastMCP

mcp = FastMCP("server-name")

@mcp.tool()
def tool_name(param1: str, param2: int) -> str:
    """Tool description for LLM."""
    # Implementation
    return "Result"

if __name__ == "__main__":
    mcp.run(transport="streamable-http")
```

### 2. Error Handling
- Implement comprehensive error handling
- Return descriptive error messages
- Use appropriate HTTP status codes
- Log errors for debugging

### 3. Performance Optimization
- Implement caching where appropriate
- Use connection pooling for database access
- Optimize resource loading
- Consider implementing rate limiting

---

## SDK Requirements

### TypeScript SDK

#### Package.json Requirements
```json
{
  "name": "mcp-server-name",
  "version": "1.0.0",
  "type": "module",
  "bin": {
    "server-name": "./build/index.js"
  },
  "scripts": {
    "build": "tsc && chmod 755 build/index.js",
    "dev": "tsx watch src/index.ts",
    "test": "jest"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.0.0"
  },
  "files": ["build"],
  "engines": {
    "node": ">=16.0.0"
  }
}
```

#### TypeScript Configuration
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "NodeNext",
    "moduleResolution": "NodeNext",
    "outDir": "./build",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "build"]
}
```

### Python SDK

#### Requirements
- Python 3.8 or higher
- MCP SDK version 1.2.0+
- FastMCP for simplified development

#### Project Structure
```
mcp-server/
├── pyproject.toml
├── src/
│   └── server.py
├── tests/
└── README.md
```

---

## Manifest Configuration

### manifest.json Structure
```json
{
  "dxt_version": "0.1.0",
  "name": "server-name",
  "version": "1.0.0",
  "description": "Server description",
  "author": {
    "name": "Author Name",
    "email": "email@example.com"
  },
  "server": {
    "command": "node",
    "args": ["./build/index.js"],
    "env": {
      "NODE_ENV": "production"
    }
  },
  "capabilities": {
    "tools": true,
    "resources": true,
    "prompts": true
  },
  "permissions": {
    "network": ["https://api.example.com"],
    "filesystem": {
      "read": ["./data"],
      "write": ["./output"]
    }
  },
  "config": {
    "schema": {
      "type": "object",
      "properties": {
        "apiKey": {
          "type": "string",
          "description": "API key for service",
          "required": true
        }
      }
    }
  }
}
```

### Desktop Extension Fields (Claude Desktop)
- **dxt_version**: Extension spec version
- **install_type**: "npm" or "python"
- **runtime**: Node.js or Python version requirements

---

## Testing and Validation

### 1. Unit Testing
- Test individual tools in isolation
- Mock external dependencies
- Validate input/output schemas
- Test error conditions

### 2. Integration Testing
- Test server initialization
- Validate capability negotiation
- Test transport mechanisms
- Verify session management

### 3. Security Testing
- Perform SAST scanning
- Check for dependency vulnerabilities
- Test permission boundaries
- Validate OAuth flows

### 4. Compliance Validation

#### Required Checks
- [ ] OAuth 2.1 implementation
- [ ] Resource Indicator support
- [ ] Human-in-the-loop consent
- [ ] Proper error handling
- [ ] Schema validation
- [ ] Transport compatibility
- [ ] Security headers
- [ ] Rate limiting

#### Testing Tools
```bash
# TypeScript testing
npm run test
npm run lint
npm run type-check

# Python testing
pytest
mypy src/
ruff check src/

# Security scanning
npm audit
pip-audit
```

---

## Platform-Specific Requirements

### Claude Desktop
- Support stdio transport
- Include manifest.json
- Package as NPM module or Python package

### ChatGPT Desktop
- Support HTTP/SSE transport
- Implement OAuth discovery endpoint
- Follow OpenAI's tool schema format

### Microsoft Copilot
- Support streamable HTTP
- Integrate with Dataverse
- Provide tracing metadata

### Google Gemini
- Support WebSocket transport
- Implement batch tool calls
- Follow Gemini's response format

---

## Migration Guide (2024 → 2025)

### Breaking Changes
1. **Transport**: Migrate from HTTP+SSE to Streamable HTTP
2. **Auth**: Implement OAuth 2.1 and Resource Indicators
3. **Security**: Add mandatory permission prompts

### Deprecations
- Legacy authentication methods
- Unscoped access tokens
- Implicit tool execution

---

## Compliance Checklist

### Essential Requirements
- [ ] Implement client-server architecture
- [ ] Support at least one transport mechanism
- [ ] Provide tools, resources, or prompts
- [ ] Include valid manifest.json
- [ ] Implement OAuth 2.1 (if authentication required)
- [ ] Add Resource Indicators (client implementations)
- [ ] Obtain user consent for tool execution
- [ ] Handle errors gracefully
- [ ] Follow security best practices
- [ ] Document all capabilities

### Recommended Practices
- [ ] Support multiple transport types
- [ ] Implement session management
- [ ] Add comprehensive logging
- [ ] Include unit and integration tests
- [ ] Perform security scanning
- [ ] Optimize for performance
- [ ] Provide clear documentation
- [ ] Include usage examples
- [ ] Support configuration options
- [ ] Implement rate limiting

---

## Resources and References

### Official Documentation
- [MCP Specification](https://spec.modelcontextprotocol.io)
- [TypeScript SDK](https://github.com/modelcontextprotocol/typescript-sdk)
- [Python SDK](https://github.com/modelcontextprotocol/python-sdk)
- [Example Servers](https://github.com/modelcontextprotocol/servers)

### Community Resources
- [MCP Discord Server](https://discord.gg/mcp)
- [Stack Overflow Tag: mcp-protocol](https://stackoverflow.com/questions/tagged/mcp-protocol)

### Security Resources
- RFC 8707: Resource Indicators for OAuth 2.0
- OAuth 2.1 Specification
- OWASP Security Guidelines

---

## Version History
- **v1.0** (August 2025): Initial comprehensive guide
- Based on MCP Specification 2025-06-18
- Incorporates all 2025 security updates

---

*This guide represents the current MCP requirements as of August 2025. Always refer to the official specification for the most up-to-date information.*